<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NYC Pool Bars</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <h1 class="logo">
      <img class="logo-img" src="finallogoupdate.png" alt="NYC Pool Bars" />
    </h1>
    <div class="header-user" id="header-user">
      <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <a class="header-leaderboard-link" href="/leaderboard/">Leaderboard</a>
      <span class="header-sign-in" id="header-sign-in">Sign In</span>
    </div>
  </header>

  <main class="main">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Bars</h2>
        <span class="bar-count" id="bar-count">0</span>
      </div>
      <div class="search-wrap">
        <input type="text" id="search" class="search" placeholder="Search bars..." autocomplete="off" />
      </div>
      <button class="suggest-bar-btn" id="suggest-bar-btn">+ Know a spot we're missing?</button>
      <div class="sidebar-controls">
        <div class="control-group">
          <span class="control-label">Sort by:</span>
          <div class="control-dropdown" id="sort-dropdown">
            <button class="control-trigger" id="sort-trigger">
              <span id="sort-label">Rating</span>
              <span class="control-arrow">▼</span>
            </button>
            <div class="control-menu" id="sort-menu">
              <button class="control-option selected" data-sort="rating">Rating</button>
              <button class="control-option" data-sort="name-az">Name (A-Z)</button>
              <button class="control-option" data-sort="name-za">Name (Z-A)</button>
              <button class="control-option" data-sort="nearest">Nearest to Me</button>
            </div>
          </div>
        </div>
        <div class="control-group">
          <span class="control-label">Filter:</span>
          <div class="control-dropdown" id="filter-dropdown">
            <button class="control-trigger" id="filter-trigger">
              <span id="filter-label">All</span>
              <span class="control-arrow">▼</span>
            </button>
            <div class="control-menu" id="filter-menu">
              <button class="control-option selected" data-filter="all">All Neighborhoods</button>
            </div>
          </div>
        </div>
      </div>
      <div class="open-now-wrap">
        <button class="open-now-toggle" id="open-now-toggle">
          <span class="open-now-dot"></span>
          Open Now
        </button>
      </div>
      <ul class="bar-list" id="bar-list"></ul>
      <div class="sidebar-bottom-fade"></div>
    </aside>

    <div class="map-wrap">
      <div id="map"></div>
    </div>
  </main>

  <!-- Bar Detail Modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal-container" id="bar-detail">
      <button type="button" class="modal-close" id="detail-close" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="modal-content" id="detail-content"></div>
    </div>
  </div>

  <!-- Rating UI -->
  <div class="rating-ui" id="rating-ui">
    <div class="rating-ui-content">
      <header class="rating-header">
        <button class="back-btn" id="rating-back">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          BACK TO LIST
        </button>
        <span class="rating-title">RATE THIS POOL BAR</span>
        <div class="user-profile" id="rating-user-profile"></div>
      </header>

      <div class="establishment-card">
        <h1 class="establishment-name" id="rating-bar-name">Amsterdam Billiard Club</h1>
        <div class="establishment-address" id="rating-bar-address">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="10" r="3"/><path d="M12 2a8 8 0 0 1 8 8c0 5-8 12-8 12s-8-7-8-12a8 8 0 0 1 8-8z"/></svg>
          <span id="rating-address-text">344 Amsterdam Ave, New York, NY 10024</span>
          <span>•</span>
          <span id="rating-neighborhood">UPPER WEST SIDE</span>
        </div>
      </div>

      <div class="rating-section-header">
        <span class="rating-section-title">RATE EACH CATEGORY</span>
        <span class="rating-progress"><span class="completed" id="completed-count">0</span> / 8 Completed</span>
      </div>

      <div class="rating-grid" id="rating-grid"></div>

      <div class="notes-card">
        <div class="notes-header">
          <div class="notes-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/></svg>
          </div>
          <div class="notes-info">
            <h3 class="notes-title">Notes</h3>
            <p class="notes-subtitle">SHARE ADDITIONAL THOUGHTS OR DETAILS</p>
          </div>
        </div>
        <textarea class="notes-textarea" id="rating-notes" placeholder="What stood out to you? Any specific recommendations or warnings for other players?"></textarea>
      </div>

      <div class="overall-submit-row">
        <div class="overall-experience">
          <div class="overall-experience-label">OVERALL EXPERIENCE</div>
          <div class="overall-experience-value" id="overall-value">-- <span>/ 5.0</span></div>
        </div>
        <button class="submit-btn" id="submit-review">
          SUBMIT REVIEW
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
        </button>
      </div>
      <div class="submit-section">
        <p class="submit-disclaimer">By submitting this review, you certify that this feedback is based on your own experience and is your genuine opinion of this establishment.</p>
      </div>
    </div>
  </div>

  <!-- Mobile List/Map Toggle -->
  <div class="mobile-toggle" id="mobile-toggle">
    <button class="mobile-toggle-btn active" data-view="list">List</button>
    <button class="mobile-toggle-btn" data-view="map">Map</button>
  </div>

  <!-- Suggest a Bar Modal -->
  <div class="suggest-overlay" id="suggest-overlay">
    <div class="suggest-modal">
      <button type="button" class="suggest-close" id="suggest-close" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      <h2 class="suggest-title">Know a spot we're missing?</h2>
      <p class="suggest-subtitle">Submit a pool bar and we'll check it out.</p>
      <form id="suggest-bar-form" class="suggest-form">
        <label class="suggest-label">Bar Name <span class="suggest-required">*</span></label>
        <input type="text" class="suggest-input" id="suggest-name" required placeholder="e.g. Corner Pocket" />
        <label class="suggest-label">Address or Cross Streets <span class="suggest-required">*</span></label>
        <input type="text" class="suggest-input" id="suggest-address" required placeholder="e.g. 123 Main St or Main & 1st" />
        <label class="suggest-label">Neighborhood</label>
        <input type="text" class="suggest-input" id="suggest-neighborhood" placeholder="e.g. East Village" />
        <div class="suggest-row">
          <div class="suggest-field">
            <label class="suggest-label">Price</label>
            <input type="text" class="suggest-input" id="suggest-price" placeholder="e.g. $2/game" />
          </div>
          <div class="suggest-field">
            <label class="suggest-label">Number of Tables</label>
            <input type="text" class="suggest-input" id="suggest-tables" placeholder="e.g. 2" />
          </div>
        </div>
        <button type="submit" class="suggest-submit">Submit Suggestion</button>
      </form>
    </div>
  </div>

  <!-- Submit Bar Info Modal -->
  <div class="suggest-overlay" id="info-overlay">
    <div class="suggest-modal suggest-modal-sm">
      <button type="button" class="suggest-close" id="info-close" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      <h2 class="suggest-title" id="info-title">Submit Info</h2>
      <p class="suggest-subtitle" id="info-subtitle"></p>
      <form id="info-form" class="suggest-form">
        <input type="hidden" id="info-bar-id" />
        <input type="hidden" id="info-bar-name" />
        <input type="hidden" id="info-field-type" />
        <label class="suggest-label" id="info-label">Value</label>
        <input type="text" class="suggest-input" id="info-value" required />
        <button type="submit" class="suggest-submit">Submit</button>
      </form>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="suggest-overlay" id="auth-overlay">
    <div class="suggest-modal">
      <button type="button" class="suggest-close" id="auth-close" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      <h2 class="suggest-title" id="auth-title">Sign In</h2>
      <p class="suggest-subtitle" id="auth-subtitle">Sign in to track your reviews.</p>
      <form id="auth-form" class="suggest-form">
        <div id="auth-username-field" style="display:none;">
          <label class="suggest-label">Username <span class="suggest-required">*</span></label>
          <input type="text" class="suggest-input" id="auth-username" placeholder="e.g. poolshark42" />
        </div>
        <label class="suggest-label">Email <span class="suggest-required">*</span></label>
        <input type="email" class="suggest-input" id="auth-email" required placeholder="you@example.com" />
        <label class="suggest-label">Password <span class="suggest-required">*</span></label>
        <input type="password" class="suggest-input" id="auth-password" required placeholder="Min 6 characters" minlength="6" />
        <p class="auth-error" id="auth-error" style="display:none;"></p>
        <button type="submit" class="suggest-submit" id="auth-submit-btn">Sign In</button>
      </form>
      <p class="auth-toggle" id="auth-toggle">
        Don't have an account? <span class="auth-toggle-link" id="auth-toggle-link">Sign Up</span>
      </p>
    </div>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqMQ20cbuHg_031zsxAPEDlPz2NsOJxgo"></script>
  <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
